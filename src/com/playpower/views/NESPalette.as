package com.playpower.views{	import flash.display.Sprite;	import flash.display.Graphics;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.text.TextField;	import com.carlcalderon.arthropod.Debug;	import com.playpower.core.*;	import com.playpower.events.CustomEvent;	import com.playpower.ui.PP_TileButton;	public class NESPalette extends Sprite	{		private var _controller:Controller;		private var _tiles:Sprite;		private var _tileArr:Array;		private var _background:Sprite;		private var _padding:int = 5;		private var _label:TextField;		private var _hexDisplay:Boolean = true;						public function NESPalette()		{			_controller = Controller.getInstance();			this.addEventListener(Event.ADDED_TO_STAGE, _onAddedToStage, false, 0, true);		}		public function _onAddedToStage($e:Event):void		{			Debug.log("NESPalette added to stage");			this.removeEventListener(Event.ADDED_TO_STAGE, _onAddedToStage);						_background = new Sprite();			this.addChild(_background);						_tiles = new Sprite();			this.addChild(_tiles);			//_tiles.x = _tiles.y = _padding;			_tileArr = [];			var yy:Number = 0; //y-coord of tile			for(var i=0; i<(Constants.NES_PALETTE_WIDTH/Constants.COLOR_TILE_WIDTH)*(Constants.NES_PALETTE_HEIGHT/Constants.COLOR_TILE_HEIGHT); i++)			{				// figure the y based on where we are in the loop				if ( (i*Constants.COLOR_TILE_WIDTH)%Constants.NES_PALETTE_WIDTH == 0 && i!=0) yy += Constants.COLOR_TILE_HEIGHT;				var tile:PP_TileButton = new PP_TileButton(_controller.nesArr[i]);				tile.addEventListener(CustomEvent.BUTTON_UP, _onTileUp, false, 0, true);				tile.x = (i*Constants.COLOR_TILE_WIDTH) - (Constants.NES_PALETTE_WIDTH*(yy/Constants.COLOR_TILE_HEIGHT));				tile.y = yy;								_tiles.addChild(tile);				_tileArr.push(tile);			}			var g:Graphics = _background.graphics;			g.beginFill(0xFFFFFF);			g.drawRect(-_padding,-_padding,_tiles.width+ (_padding*2)-2,_tiles.height+ (_padding*2)-3);			g.endFill();						_label = CustomTextField.getTextField("",0x000000,12);			_label.y = -1*Constants.GUTTER_WIDTH*1.5;			this.addChild(_label);		}				public function toggleHexDisplay():void		{			for(var i=0; i<_tileArr.length; i++)			{				var tile:PP_TileButton = _tileArr[i] as PP_TileButton;				tile.toggleString();			}						_hexDisplay = !_hexDisplay;		}				public function get hexDisplay():Boolean		{			return _hexDisplay;		}				public function setLabel(str:String):void		{			_label.text = str;		}				private function _onTileOver($e:CustomEvent):void		{		}				private function _onTileOff($e:CustomEvent):void		{		}				private function _onTileDown($e:CustomEvent):void		{		}				private function _onTileUp($e:CustomEvent):void		{			dispatchEvent( $e );		}				public function destroy():void		{			for(var i=0; i<_tileArr.length; i++)			{				var tile:PP_TileButton = _tileArr[i] as PP_TileButton;				_tiles.removeChild(tile);				tile.removeEventListener(CustomEvent.BUTTON_UP, _onTileUp);				tile.destroy();				tile = null;			}			_tileArr = [];			this.removeChild(_tiles);			_tiles = null;			this.removeChild(_background);			_background = null;			_controller = null;		}	}}